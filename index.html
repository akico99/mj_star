<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>무주스키샵 견적/예약</title>
  <style>
    :root { --bg:#0b0c10; --card:#12141a; --muted:#9aa3b2; --text:#e8ecf3; --line:#242a36; --accent:#5eead4; --warn:#ffcf66; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif; background: linear-gradient(180deg, #0b0c10, #0b0c10 40%, #0a1220); color:var(--text); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px 14px 90px; }
    header { display:flex; gap:12px; align-items:flex-end; justify-content:space-between; margin-bottom: 12px; }
    h1 { margin:0; font-size: 18px; letter-spacing:-0.2px; }
    .sub { color: var(--muted); font-size: 12px; }

    .tabs { display:flex; gap:10px; margin: 14px 0 12px; }
    .tabbtn { flex:1; border:1px solid var(--line); background: rgba(255,255,255,0.02); color:var(--text);
      padding: 12px 10px; border-radius: 12px; cursor:pointer; font-weight: 700; }
    .tabbtn.active { border-color: rgba(94,234,212,0.5); box-shadow: 0 0 0 3px rgba(94,234,212,0.12) inset; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 860px) { .grid { grid-template-columns: 1.1fr 0.9fr; align-items:start; } }

    .card { background: rgba(18,20,26,0.92); border: 1px solid var(--line); border-radius: 16px; padding: 14px; }
    .card h2 { margin: 0 0 10px; font-size: 14px; color: #dfe6f3; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .field { display:flex; flex-direction:column; gap:6px; flex:1; min-width: 160px; }
    label { font-size: 12px; color: var(--muted); }
    input[type="text"], input[type="tel"], input[type="time"], input[type="date"], textarea, select {
      background: rgba(255,255,255,0.03); border:1px solid var(--line); color:var(--text);
      padding: 10px 10px; border-radius: 12px; outline:none;
    }
    textarea { min-height: 90px; resize: vertical; }

    .seg { display:flex; gap:8px; flex-wrap:wrap; }
    .seg label { display:flex; align-items:center; gap:6px; padding: 10px 10px; border:1px solid var(--line); border-radius: 12px;
      background: rgba(255,255,255,0.02); cursor:pointer; user-select:none; }
    .seg input { accent-color: var(--accent); }

    .step { display:flex; align-items:center; gap:10px; justify-content:space-between; padding: 10px 10px; border: 1px solid var(--line); border-radius: 12px; background: rgba(255,255,255,0.02); }
    .step .left { display:flex; flex-direction:column; gap:2px; }
    .step .name { font-weight: 700; font-size: 13px; }
    .step .hint { color: var(--muted); font-size: 12px; word-break: keep-all; }
    .step .ctrl { display:flex; align-items:center; gap:8px; }
    .btn { border:1px solid var(--line); background: rgba(255,255,255,0.03); color:var(--text);
      padding: 10px 10px; border-radius: 12px; cursor:pointer; font-weight: 800; }
    .btn:active { transform: translateY(1px); }
    .btn.primary { border-color: rgba(94,234,212,0.6); box-shadow: 0 0 0 3px rgba(94,234,212,0.10) inset; }
    .btn.danger { border-color: rgba(255,99,132,0.35); }
    .mini { width: 38px; height: 34px; padding:0; display:grid; place-items:center; font-size: 18px; }
    .count { min-width: 28px; text-align:center; font-weight: 900; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding: 8px 10px; border:1px solid var(--line); border-radius: 999px; background: rgba(255,255,255,0.02); color: #dbe4f3; font-size: 12px; }

    .stickyTotal {
      position: sticky; top: 10px; z-index: 2;
      display:flex; flex-direction:column; gap: 10px;
    }
    .totalBox { border:1px solid rgba(94,234,212,0.35); border-radius: 16px; padding: 14px;
      background: radial-gradient(1200px 200px at 0% 0%, rgba(94,234,212,0.14), rgba(18,20,26,0.92)); }
    .totalLabel { color: var(--muted); font-size: 12px; }
    .totalValue { font-size: 28px; font-weight: 950; letter-spacing: -0.6px; margin-top: 4px; }
    .note { color: var(--muted); font-size: 12px; line-height: 1.5; }
    .warn { color: var(--warn); font-size: 12px; line-height: 1.5; }

    details { border:1px solid var(--line); border-radius: 14px; background: rgba(255,255,255,0.02); padding: 10px 12px; }
    details > summary { cursor:pointer; font-weight: 800; }
    .breakdown { margin-top: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; white-space: pre-wrap; color: #dbe4f3; }
    .outBox { width:100%; }
    .toast { position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%); background: rgba(18,20,26,0.96);
      border:1px solid var(--line); padding: 10px 12px; border-radius: 999px; color: var(--text); font-weight: 800; display:none; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>무주스키샵 견적/예약 계산기</h1>
        <div class="sub">저장 기능 없이, 실시간 견적 + 복사만 되는 가벼운 버전</div>
      </div>
      <div class="pill" id="dayTypePill">이용일 미선택</div>
    </header>

    <div class="tabs">
      <button class="tabbtn active" id="tabQuote">견적내기</button>
      <button class="tabbtn" id="tabReserve">예약정보 입력</button>
    </div>

    <!-- 견적내기 -->
    <section id="viewQuote" class="grid">
      <div class="card">
        <h2>1) 이용일 / 인원</h2>
        <div class="row">
          <div class="field">
            <label>이용일 (달력 선택)</label>
            <input type="date" id="q_date" />
          </div>
          <div class="field">
            <label>표시</label>
            <input type="text" id="q_dateLabel" placeholder="YYYY-MM-DD (요일 · 주중/주말)" readonly />
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <label>대인</label>
            <div class="step">
              <div class="left">
                <div class="name">대인</div>
                <div class="hint">리프트권 대인 단가 적용</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_adult" data-delta="-1">−</button>
                <div class="count" id="q_adult">0</div>
                <button class="btn mini" data-step="q_adult" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <label>소인</label>
            <div class="step">
              <div class="left">
                <div class="name">소인</div>
                <div class="hint">리프트권 소인 단가 적용</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_child" data-delta="-1">−</button>
                <div class="count" id="q_child">0</div>
                <button class="btn mini" data-step="q_child" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="pill">총 인원: <b id="q_totalPeople">0</b>명</div>

        <div style="height:16px"></div>
        <h2>2) 리프트권</h2>
        <div class="seg" id="q_liftSeg">
          <label><input type="radio" name="q_lift" value="none" checked> 없음</label>
          <label><input type="radio" name="q_lift" value="3"> 3시간권</label>
          <label><input type="radio" name="q_lift" value="4"> 4시간권</label>
          <label><input type="radio" name="q_lift" value="6"> 6시간권</label>
        </div>

        <div style="height:16px"></div>
        <h2>3) 장비 / 의류</h2>

        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">장비렌탈</div>
                <div class="hint">15,000원 / 1인</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_equipment" data-delta="-1">−</button>
                <div class="count" id="q_equipment">0</div>
                <button class="btn mini" data-step="q_equipment" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">스키에이트</div>
                <div class="hint">20,000원 / 1인 (옵션)</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_skiate" data-delta="-1">−</button>
                <div class="count" id="q_skiate">0</div>
                <button class="btn mini" data-step="q_skiate" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">고급의류</div>
                <div class="hint">15,000원 / 1인</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_clothHigh" data-delta="-1">−</button>
                <div class="count" id="q_clothHigh">0</div>
                <button class="btn mini" data-step="q_clothHigh" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">프리미엄의류</div>
                <div class="hint">20,000원 / 1인</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_clothPremium" data-delta="-1">−</button>
                <div class="count" id="q_clothPremium">0</div>
                <button class="btn mini" data-step="q_clothPremium" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:14px"></div>

        <details>
          <summary>추가 옵션 (보호대/헬멧)</summary>
          <div style="height:10px"></div>

          <div class="row">
            <div class="field">
              <div class="step">
                <div class="left">
                  <div class="name">보호대</div>
                  <div class="hint">5,000원 / 1인</div>
                </div>
                <div class="ctrl">
                  <button class="btn mini" data-step="q_pad" data-delta="-1">−</button>
                  <div class="count" id="q_pad">0</div>
                  <button class="btn mini" data-step="q_pad" data-delta="1">+</button>
                </div>
              </div>
            </div>

            <div class="field">
              <div class="step">
                <div class="left">
                  <div class="name">헬멧 또는 고글</div>
                  <div class="hint">10,000원 / 1인</div>
                </div>
                <div class="ctrl">
                  <button class="btn mini" data-step="q_helmet" data-delta="-1">−</button>
                  <div class="count" id="q_helmet">0</div>
                  <button class="btn mini" data-step="q_helmet" data-delta="1">+</button>
                </div>
              </div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="row">
            <div class="field">
              <div class="step">
                <div class="left">
                  <div class="name">헬멧 + 고글</div>
                  <div class="hint">15,000원 / 1인</div>
                </div>
                <div class="ctrl">
                  <button class="btn mini" data-step="q_helmetSet" data-delta="-1">−</button>
                  <div class="count" id="q_helmetSet">0</div>
                  <button class="btn mini" data-step="q_helmetSet" data-delta="1">+</button>
                </div>
              </div>
            </div>
          </div>

          <div style="height:10px"></div>
          <div class="note">옵션은 전부 선택사항이며 0명도 가능합니다. 변경 즉시 총액이 반영됩니다.</div>
        </details>

        <div style="height:14px"></div>

        <div class="row">
          <button class="btn primary" id="btnCopyQuote">견적 복사</button>
          <button class="btn danger" id="btnResetQuote">초기화</button>
        </div>

        <div style="height:10px"></div>
        <div id="q_warn" class="warn"></div>
      </div>

      <div class="stickyTotal">
        <div class="totalBox">
          <div class="totalLabel">총 견적 금액</div>
          <div class="totalValue" id="q_totalPrice">₩ 0</div>
          <div class="note" id="q_totalNote">이용일을 선택하면 주중/주말이 자동 적용됩니다.</div>
        </div>

        <details open>
          <summary>상세내역</summary>
          <div class="breakdown" id="q_breakdown">(선택된 항목이 없습니다)</div>
        </details>

        <details>
          <summary>가격표 요약</summary>
          <div class="breakdown" id="q_priceRef"></div>
        </details>
      </div>
    </section>

    <!-- 예약정보 -->
    <section id="viewReserve" class="grid" style="display:none;">
      <div class="card">
        <h2>1) 예약정보 입력</h2>

        <div class="row">
          <div class="field">
            <label>성함</label>
            <input type="text" id="r_name" placeholder="예: 홍길동" />
          </div>
          <div class="field">
            <label>연락처</label>
            <input type="tel" id="r_phone" placeholder="010-0000-0000" />
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <label>이용예정일 (달력 선택)</label>
            <input type="date" id="r_date" />
          </div>
          <div class="field">
            <label>표시</label>
            <input type="text" id="r_dateLabel" placeholder="YYYY-MM-DD (요일 · 주중/주말)" readonly />
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <label>방문예정 시간</label>
            <input type="time" id="r_time" />
          </div>
          <div class="field" style="min-width:200px;">
            <label>시간 미정</label>
            <div class="seg">
              <label><input type="checkbox" id="r_timeUnknown"> 미정</label>
            </div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="field">
          <label>리프트권 시간</label>
          <div class="seg" id="r_liftSeg">
            <label><input type="radio" name="r_lift" value="none" checked> 없음</label>
            <label><input type="radio" name="r_lift" value="3"> 3시간권</label>
            <label><input type="radio" name="r_lift" value="4"> 4시간권</label>
            <label><input type="radio" name="r_lift" value="6"> 6시간권</label>
            <label><input type="radio" name="r_lift" value="unknown"> 미정</label>
          </div>
        </div>

        <div style="height:14px"></div>

        <h2>2) 인원 / 렌탈</h2>
        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">대인</div>
                <div class="hint">예약 인원</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="r_adult" data-delta="-1">−</button>
                <div class="count" id="r_adult">0</div>
                <button class="btn mini" data-step="r_adult" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">소인</div>
                <div class="hint">예약 인원</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="r_child" data-delta="-1">−</button>
                <div class="count" id="r_child">0</div>
                <button class="btn mini" data-step="r_child" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="pill">총 인원: <b id="r_totalPeople">0</b>명</div>

        <div style="height:12px"></div>

        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">렌탈 인원</div>
                <div class="hint">장비/의류 합산(원하면)</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="r_rental" data-delta="-1">−</button>
                <div class="count" id="r_rental">0</div>
                <button class="btn mini" data-step="r_rental" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:14px"></div>
        <h2>3) 메모</h2>
        <div class="field">
          <textarea id="r_memo" placeholder="예: 픽업 문의 / 사이즈 / 결제 방식 / 요청사항"></textarea>
        </div>

        <div style="height:14px"></div>
        <div class="row">
          <button class="btn primary" id="btnCopyReserve">정리본 복사</button>
          <button class="btn" id="btnCopyReserveWithQuote">정리본+견적 같이 복사</button>
          <button class="btn danger" id="btnResetReserve">초기화</button>
        </div>
      </div>

      <div class="stickyTotal">
        <div class="totalBox">
          <div class="totalLabel">예약정보 정리본</div>
          <div class="note">복사 버튼을 누르면 아래 내용이 클립보드에 저장됩니다.</div>
        </div>

        <div class="card">
          <textarea class="outBox" id="r_output" readonly></textarea>
        </div>

        <div class="note">Tip) 견적 화면에서 “예약으로 넘기기”가 필요하면, 이후 버튼 하나로 자동 채움도 쉽게 추가됩니다.</div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">복사 완료</div>

  <script>
    // -------------------------
    // 가격표
    // -------------------------
    const PRICES = {
      equipment: 15000,
      skiate: 20000,
      clothHigh: 15000,
      clothPremium: 20000,
      pad: 5000,
      helmet: 10000,
      helmetSet: 15000,
      lift: {
        weekday: {
          "3": { adult: 44000, child: 35000 },
          "4": { adult: 51000, child: 41000 },
          "6": { adult: 58000, child: 47000 },
        },
        weekend: {
          "3": { adult: 54000, child: 43000 },
          "4": { adult: 61000, child: 49000 },
          "6": { adult: 69000, child: 55000 },
        }
      }
    };

    // -------------------------
    // 유틸
    // -------------------------
    const $ = (id) => document.getElementById(id);
    const fmt = (n) => "₩ " + Number(n || 0).toLocaleString("ko-KR");
    const toast = (msg="완료") => {
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=> t.style.display="none", 1200);
    };

    function getDayTypeFromDate(isoDate) {
      if (!isoDate) return null;
      const d = new Date(isoDate + "T00:00:00");
      const day = d.getDay(); // 0 Sun .. 6 Sat
      const weekdayNames = ["일","월","화","수","목","금","토"];
      const isWeekend = (day === 0 || day === 6);
      return {
        dayType: isWeekend ? "weekend" : "weekday",
        label: isWeekend ? "주말" : "주중",
        dow: weekdayNames[day],
        iso: isoDate
      };
    }

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function readCount(id) {
      return Number($(id).textContent || 0);
    }
    function setCount(id, val) {
      $(id).textContent = String(val);
    }

    // -------------------------
    // 탭 전환
    // -------------------------
    const tabQuote = $("tabQuote");
    const tabReserve = $("tabReserve");
    const viewQuote = $("viewQuote");
    const viewReserve = $("viewReserve");

    tabQuote.addEventListener("click", () => {
      tabQuote.classList.add("active");
      tabReserve.classList.remove("active");
      viewQuote.style.display = "";
      viewReserve.style.display = "none";
      syncDayTypePill();
    });

    tabReserve.addEventListener("click", () => {
      tabReserve.classList.add("active");
      tabQuote.classList.remove("active");
      viewReserve.style.display = "";
      viewQuote.style.display = "none";
      syncDayTypePill();
      updateReserveOutput();
    });

    function syncDayTypePill() {
      // 현재 보이는 화면의 날짜 기준으로 상단 pill 표시
      const isQuote = viewQuote.style.display !== "none";
      const iso = isQuote ? $("q_date").value : $("r_date").value;
      const info = getDayTypeFromDate(iso);
      const pill = $("dayTypePill");
      if (!info) {
        pill.textContent = "이용일 미선택";
        return;
      }
      pill.textContent = `${info.iso} (${info.dow} · ${info.label})`;
    }

    // -------------------------
    // Stepper 공통 핸들러
    // -------------------------
    document.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-step]");
      if (!btn) return;
      const id = btn.getAttribute("data-step");
      const delta = Number(btn.getAttribute("data-delta"));
      const isQuote = id.startsWith("q_");
      const max = 99;

      const cur = readCount(id);
      let next = clamp(cur + delta, 0, max);
      setCount(id, next);

      if (isQuote) {
        enforceQuoteRules();
        updateQuote();
      } else {
        enforceReserveRules();
        updateReserveOutput();
      }
    });

    // -------------------------
    // 견적 화면 로직
    // -------------------------
    $("q_date").addEventListener("change", () => {
      const info = getDayTypeFromDate($("q_date").value);
      $("q_dateLabel").value = info ? `${info.iso} (${info.dow} · ${info.label})` : "";
      syncDayTypePill();
      updateQuote();
    });

    document.querySelectorAll('input[name="q_lift"]').forEach(r => {
      r.addEventListener("change", updateQuote);
    });

    function quoteTotals() {
      const adult = readCount("q_adult");
      const child = readCount("q_child");
      const totalPeople = adult + child;

      const dateInfo = getDayTypeFromDate($("q_date").value);
      const dayType = dateInfo ? dateInfo.dayType : "weekday"; // 날짜 없으면 임시 주중 기준
      const liftSel = document.querySelector('input[name="q_lift"]:checked')?.value || "none";

      // 렌탈/옵션
      const equipment = readCount("q_equipment");
      const skiate = readCount("q_skiate");
      const clothHigh = readCount("q_clothHigh");
      const clothPremium = readCount("q_clothPremium");
      const pad = readCount("q_pad");
      const helmet = readCount("q_helmet");
      const helmetSet = readCount("q_helmetSet");

      // 리프트
      let liftTotal = 0;
      if (liftSel !== "none" && PRICES.lift[dayType][liftSel]) {
        const p = PRICES.lift[dayType][liftSel];
        liftTotal = p.adult * adult + p.child * child;
      }

      const items = [];
      if (liftSel !== "none") {
        const p = PRICES.lift[dayType][liftSel];
        items.push({
          key: "lift",
          label: `리프트권(${liftSel}시간 · ${dayType === "weekend" ? "주말" : "주중"})`,
          amount: liftTotal,
          detail: (p ? `- 대인 ${p.adult.toLocaleString()}원 × ${adult}\n- 소인 ${p.child.toLocaleString()}원 × ${child}` : "")
        });
      }

      const addLine = (label, unit, qty) => {
        if (qty <= 0) return;
        items.push({ key: label, label, amount: unit * qty, detail: `${unit.toLocaleString()}원 × ${qty}` });
      };

      addLine("장비렌탈", PRICES.equipment, equipment);
      addLine("스키에이트", PRICES.skiate, skiate);
      addLine("고급의류", PRICES.clothHigh, clothHigh);
      addLine("프리미엄의류", PRICES.clothPremium, clothPremium);
      addLine("보호대", PRICES.pad, pad);
      addLine("헬멧 또는 고글", PRICES.helmet, helmet);
      addLine("헬멧+고글", PRICES.helmetSet, helmetSet);

      const total = items.reduce((s, x) => s + x.amount, 0);

      return {
        adult, child, totalPeople,
        dayType, dateInfo, liftSel,
        equipment, skiate, clothHigh, clothPremium, pad, helmet, helmetSet,
        items, total
      };
    }

    function enforceQuoteRules() {
      const adult = readCount("q_adult");
      const child = readCount("q_child");
      const totalPeople = adult + child;

      // 총인원 표시
      $("q_totalPeople").textContent = String(totalPeople);

      // 공통: 각 항목은 0~총인원
      const capToPeople = (id) => setCount(id, clamp(readCount(id), 0, totalPeople));

      ["q_equipment","q_skiate","q_clothHigh","q_clothPremium","q_pad","q_helmet","q_helmetSet"].forEach(capToPeople);

      // 장비 중복 방지: 장비렌탈 + 스키에이트 <= 총인원
      let eq = readCount("q_equipment");
      let sk = readCount("q_skiate");
      if (eq + sk > totalPeople) {
        // 방금 변경된 쪽을 모르니, 스키에이트부터 줄이는 방식
        const overflow = (eq + sk) - totalPeople;
        sk = clamp(sk - overflow, 0, totalPeople);
        setCount("q_skiate", sk);
      }

      // 의류 합계 제한: 고급 + 프리미엄 <= 총인원
      let ch = readCount("q_clothHigh");
      let cp = readCount("q_clothPremium");
      if (ch + cp > totalPeople) {
        const overflow = (ch + cp) - totalPeople;
        cp = clamp(cp - overflow, 0, totalPeople);
        setCount("q_clothPremium", cp);
      }

      // 헬멧 중복 방지
      let h = readCount("q_helmet");
      let hs = readCount("q_helmetSet");
      if (h + hs > totalPeople) {
        const overflow = (h + hs) - totalPeople;
        hs = clamp(hs - overflow, 0, totalPeople);
        setCount("q_helmetSet", hs);
      }

      // 경고 문구
      const warns = [];
      if (!$("q_date").value) warns.push("이용일을 선택하면 주중/주말 요금이 자동 적용됩니다. (현재는 주중 기준으로 임시 계산)");
      if (totalPeople === 0 && (readCount("q_equipment")+readCount("q_skiate")+readCount("q_clothHigh")+readCount("q_clothPremium")+readCount("q_pad")+readCount("q_helmet")+readCount("q_helmetSet")) > 0) {
        warns.push("총 인원이 0명이라 옵션 인원이 자동으로 0으로 맞춰졌습니다.");
      }
      $("q_warn").textContent = warns.join("\n");
    }

    function updateQuote() {
      enforceQuoteRules();
      const t = quoteTotals();

      $("q_totalPrice").textContent = fmt(t.total);
      $("q_totalPeople").textContent = String(t.totalPeople);

      // note
      if (t.dateInfo) {
        $("q_totalNote").textContent = `${t.dateInfo.iso} (${t.dateInfo.dow} · ${t.dateInfo.label}) 기준으로 계산됩니다.`;
      } else {
        $("q_totalNote").textContent = "이용일을 선택하면 주중/주말이 자동 적용됩니다. (현재는 주중 기준 임시 계산)";
      }

      // breakdown text
      if (t.items.length === 0) {
        $("q_breakdown").textContent = "(선택된 항목이 없습니다)";
      } else {
        const lines = [];
        lines.push(`[무주스키샵 견적]`);
        if (t.dateInfo) lines.push(`이용일: ${t.dateInfo.iso} (${t.dateInfo.dow} · ${t.dateInfo.label})`);
        else lines.push(`이용일: 미선택(주중 기준 임시 계산)`);
        lines.push(`인원: 대인 ${t.adult} / 소인 ${t.child} (총 ${t.totalPeople}명)`);
        lines.push("");

        for (const it of t.items) {
          lines.push(`${it.label}: ${it.amount.toLocaleString()}원`);
          if (it.detail) lines.push(it.detail);
          lines.push("");
        }
        lines.push(`총 견적 금액: ${t.total.toLocaleString()}원`);

        $("q_breakdown").textContent = lines.join("\n").trim();
      }

      // 가격표 요약
      const priceRef = [];
      priceRef.push(`장비 15,000 / 스키에이트 20,000`);
      priceRef.push(`고급의류 15,000 / 프리미엄의류 20,000`);
      priceRef.push(`보호대 5,000 / 헬멧or고글 10,000 / 헬멧+고글 15,000`);
      priceRef.push("");
      priceRef.push(`[3시간권] 주중 대인 44,000 / 소인 35,000 | 주말 대인 54,000 / 소인 43,000`);
      priceRef.push(`[4시간권] 주중 대인 51,000 / 소인 41,000 | 주말 대인 61,000 / 소인 49,000`);
      priceRef.push(`[6시간권] 주중 대인 58,000 / 소인 47,000 | 주말 대인 69,000 / 소인 55,000`);
      $("q_priceRef").textContent = priceRef.join("\n");
    }

    $("btnResetQuote").addEventListener("click", () => {
      $("q_date").value = "";
      $("q_dateLabel").value = "";
      ["q_adult","q_child","q_equipment","q_skiate","q_clothHigh","q_clothPremium","q_pad","q_helmet","q_helmetSet"].forEach(id => setCount(id, 0));
      document.querySelector('input[name="q_lift"][value="none"]').checked = true;
      $("q_warn").textContent = "";
      syncDayTypePill();
      updateQuote();
      toast("초기화 완료");
    });

    $("btnCopyQuote").addEventListener("click", async () => {
      updateQuote();
      const text = $("q_breakdown").textContent;
      await navigator.clipboard.writeText(text);
      toast("견적 복사 완료");
    });

    // -------------------------
    // 예약 화면 로직
    // -------------------------
    $("r_date").addEventListener("change", () => {
      const info = getDayTypeFromDate($("r_date").value);
      $("r_dateLabel").value = info ? `${info.iso} (${info.dow} · ${info.label})` : "";
      syncDayTypePill();
      updateReserveOutput();
    });

    $("r_timeUnknown").addEventListener("change", () => {
      const unk = $("r_timeUnknown").checked;
      $("r_time").disabled = unk;
      if (unk) $("r_time").value = "";
      updateReserveOutput();
    });

    document.querySelectorAll('input[name="r_lift"]').forEach(r => {
      r.addEventListener("change", updateReserveOutput);
    });

    ["r_name","r_phone","r_memo"].forEach(id => {
      $(id).addEventListener("input", updateReserveOutput);
    });

    function enforceReserveRules() {
      const adult = readCount("r_adult");
      const child = readCount("r_child");
      const total = adult + child;
      $("r_totalPeople").textContent = String(total);

      // 렌탈 인원은 0~총인원
      setCount("r_rental", clamp(readCount("r_rental"), 0, total));
    }

    function updateReserveOutput() {
      enforceReserveRules();

      const name = $("r_name").value.trim();
      const phone = $("r_phone").value.trim();
      const dateInfo = getDayTypeFromDate($("r_date").value);
      const time = $("r_timeUnknown").checked ? "미정" : ($("r_time").value || "미정");
      const lift = document.querySelector('input[name="r_lift"]:checked')?.value || "none";
      const liftLabel = (lift === "none") ? "없음" : (lift === "unknown") ? "미정" : `${lift}시간권`;

      const adult = readCount("r_adult");
      const child = readCount("r_child");
      const total = adult + child;
      const rental = readCount("r_rental");
      const memo = $("r_memo").value.trim() || "-";

      const lines = [];
      lines.push("[예약정보]");
      lines.push(`성함: ${name || "-"}`);
      lines.push(`연락처: ${phone || "-"}`);
      lines.push("");
      lines.push(`이용일: ${dateInfo ? `${dateInfo.iso} (${dateInfo.dow} · ${dateInfo.label})` : "-"}`);
      lines.push(`방문시간: ${time}`);
      lines.push(`리프트권: ${liftLabel}`);
      lines.push("");
      lines.push(`인원: 대인 ${adult} / 소인 ${child} (총 ${total}명)`);
      lines.push(`렌탈 인원: ${rental}`);
      lines.push("");
      lines.push(`메모: ${memo}`);

      $("r_output").value = lines.join("\n");
    }

    $("btnResetReserve").addEventListener("click", () => {
      ["r_name","r_phone","r_memo"].forEach(id => $(id).value = "");
      $("r_date").value = "";
      $("r_dateLabel").value = "";
      $("r_time").value = "";
      $("r_timeUnknown").checked = false;
      $("r_time").disabled = false;
      document.querySelector('input[name="r_lift"][value="none"]').checked = true;

      ["r_adult","r_child","r_rental"].forEach(id => setCount(id, 0));
      $("r_totalPeople").textContent = "0";
      updateReserveOutput();
      syncDayTypePill();
      toast("초기화 완료");
    });

    $("btnCopyReserve").addEventListener("click", async () => {
      updateReserveOutput();
      await navigator.clipboard.writeText($("r_output").value);
      toast("정리본 복사 완료");
    });

    $("btnCopyReserveWithQuote").addEventListener("click", async () => {
      updateReserveOutput();
      updateQuote();
      const combined =
        $("r_output").value +
        "\n\n" +
        "--------------------\n" +
        $("q_breakdown").textContent;
      await navigator.clipboard.writeText(combined);
      toast("정리본+견적 복사 완료");
    });

    // 초기 렌더
    updateQuote();
    updateReserveOutput();
    syncDayTypePill();
  </script>
</body>
</html>
